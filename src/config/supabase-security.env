# =============================================================================
# CONFIGURATION SUPABASE SÉCURISÉE POUR MATHILDE FLEURS
# =============================================================================

# Variables d'environnement pour la production
# À copier dans votre dashboard Supabase > Settings > Environment variables

# =============================================================================
# SÉCURITÉ GÉNÉRALE
# =============================================================================

# Désactiver les inscriptions publiques (inscription par invitation uniquement)
GOTRUE_DISABLE_SIGNUP=false

# Activer la confirmation par email
GOTRUE_MAILER_AUTOCONFIRM=false

# Activer la rotation des refresh tokens (CRITIQUES pour la sécurité)
GOTRUE_SECURITY_REFRESH_TOKEN_ROTATION_ENABLED=true
GOTRUE_SECURITY_REFRESH_TOKEN_REUSE_INTERVAL=10s

# Exiger une réauthentification pour changer le mot de passe
GOTRUE_SECURITY_UPDATE_PASSWORD_REQUIRE_REAUTHENTICATION=true

# =============================================================================
# GESTION DES MOTS DE PASSE
# =============================================================================

# Longueur minimale des mots de passe
GOTRUE_PASSWORD_MIN_LENGTH=8

# Caractères requis dans les mots de passe (majuscule:minuscule:nombre:spécial)
GOTRUE_PASSWORD_REQUIRED_CHARACTERS=abcdefghijklmnopqrstuvwxyz:ABCDEFGHIJKLMNOPQRSTUVWXYZ:0123456789:!@#$%^&*()_+-=[]{}|;:,.<>?

# =============================================================================
# RATE LIMITING (PROTECTION BRUTE FORCE)
# =============================================================================

# Header pour le rate limiting
GOTRUE_RATE_LIMIT_HEADER=X-Forwarded-For

# Limite d'emails envoyés (signup, invite, recovery, etc.)
GOTRUE_RATE_LIMIT_EMAIL_SENT=30/h

# =============================================================================
# JWT & SESSIONS
# =============================================================================

# Durée de validité des JWT (1 heure recommandée)
GOTRUE_JWT_EXP=3600

# Audience JWT (identifier votre app)
GOTRUE_JWT_AUD=mathilde-fleurs

# Nom du groupe admin
GOTRUE_JWT_ADMIN_GROUP_NAME=admin

# =============================================================================
# EMAIL CONFIGURATION SÉCURISÉE
# =============================================================================

# Fréquence maximale d'envoi d'emails de confirmation/récupération (15 minutes)
GOTRUE_SMTP_MAX_FREQUENCY=900

# Durée de validité des liens par email (1 heure)
GOTRUE_MAILER_OTP_EXP=3600

# URLs personnalisées pour les actions email
GOTRUE_MAILER_URLPATHS_INVITE=/auth/invite
GOTRUE_MAILER_URLPATHS_CONFIRMATION=/auth/confirm
GOTRUE_MAILER_URLPATHS_RECOVERY=/auth/reset-password
GOTRUE_MAILER_URLPATHS_EMAIL_CHANGE=/auth/email-change

# Sujets d'emails personnalisés
GOTRUE_MAILER_SUBJECTS_INVITE="Invitation à rejoindre Mathilde Fleurs"
GOTRUE_MAILER_SUBJECTS_CONFIRMATION="Confirmez votre compte Mathilde Fleurs"
GOTRUE_MAILER_SUBJECTS_RECOVERY="Réinitialisez votre mot de passe"
GOTRUE_MAILER_SUBJECTS_MAGIC_LINK="Votre lien de connexion Mathilde Fleurs"
GOTRUE_MAILER_SUBJECTS_EMAIL_CHANGE="Confirmez votre changement d'email"

# =============================================================================
# PROVIDERS OAUTH SÉCURISÉS
# =============================================================================

# Google OAuth
GOTRUE_EXTERNAL_GOOGLE_ENABLED=true
GOTRUE_EXTERNAL_GOOGLE_CLIENT_ID=your_google_client_id
GOTRUE_EXTERNAL_GOOGLE_SECRET=your_google_secret
GOTRUE_EXTERNAL_GOOGLE_REDIRECT_URI=https://your-project.supabase.co/auth/v1/callback

# GitHub OAuth
GOTRUE_EXTERNAL_GITHUB_ENABLED=true
GOTRUE_EXTERNAL_GITHUB_CLIENT_ID=your_github_client_id
GOTRUE_EXTERNAL_GITHUB_SECRET=your_github_secret
GOTRUE_EXTERNAL_GITHUB_REDIRECT_URI=https://your-project.supabase.co/auth/v1/callback

# Discord OAuth (optionnel)
GOTRUE_EXTERNAL_DISCORD_ENABLED=false
GOTRUE_EXTERNAL_DISCORD_CLIENT_ID=your_discord_client_id
GOTRUE_EXTERNAL_DISCORD_SECRET=your_discord_secret
GOTRUE_EXTERNAL_DISCORD_REDIRECT_URI=https://your-project.supabase.co/auth/v1/callback

# =============================================================================
# CAPTCHA (PROTECTION AVANCÉE)
# =============================================================================

# Activer le CAPTCHA pour les inscriptions
GOTRUE_SECURITY_CAPTCHA_ENABLED=true
GOTRUE_SECURITY_CAPTCHA_PROVIDER=turnstile
GOTRUE_SECURITY_CAPTCHA_SECRET=your_turnstile_secret_key
GOTRUE_SECURITY_CAPTCHA_TIMEOUT=10s

# =============================================================================
# MONITORING & OBSERVABILITÉ
# =============================================================================

# Activer les métriques
GOTRUE_METRICS_ENABLED=true
GOTRUE_METRICS_EXPORTER=prometheus

# Configuration Prometheus
OTEL_EXPORTER_PROMETHEUS_HOST=0.0.0.0
OTEL_EXPORTER_PROMETHEUS_PORT=9090

# Activer le tracing
GOTRUE_TRACING_ENABLED=true
GOTRUE_TRACING_EXPORTER=opentelemetry

# Configuration OpenTelemetry (exemple Honeycomb)
OTEL_SERVICE_NAME=mathilde-fleurs-auth
OTEL_EXPORTER_OTLP_PROTOCOL=grpc
OTEL_EXPORTER_OTLP_ENDPOINT=https://api.honeycomb.io:443
OTEL_EXPORTER_OTLP_HEADERS=x-honeycomb-team=YOUR_API_KEY,x-honeycomb-dataset=auth

# Attributs de ressource personnalisés
OTEL_RESOURCE_ATTRIBUTES=service.instance.id=mathilde-auth-prod,environment=production

# Activer le debug pour le développement (désactiver en production)
DEBUG=false

# =============================================================================
# LOGGING
# =============================================================================

# Niveau de log (info pour production, debug pour développement)
LOG_LEVEL=info

# Fichier de log (optionnel)
GOTRUE_LOG_FILE=/var/log/supabase/auth.log

# =============================================================================
# RECOMMANDATIONS DE SÉCURITÉ SUPPLÉMENTAIRES
# =============================================================================

# 1. Dans votre dashboard Supabase, activez :
#    - Row Level Security sur toutes les tables
#    - Audit logs
#    - Backup automatique
#    - SSL forcé

# 2. Configurez les politiques RLS strictes :
#    - Users peuvent seulement voir leur propre profil
#    - Admins peuvent voir tous les profils
#    - Logs d'authentification en lecture seule

# 3. Headers de sécurité à ajouter à votre app :
#    - Content-Security-Policy
#    - X-Frame-Options: DENY
#    - X-Content-Type-Options: nosniff
#    - Referrer-Policy: strict-origin-when-cross-origin

# 4. Monitoring recommandé :
#    - Alertes sur les tentatives de connexion échouées
#    - Monitoring des taux d'erreur auth
#    - Alertes sur les pics de trafic inhabituels

# =============================================================================
# VARIABLES D'ENVIRONNEMENT FRONTEND (.env)
# =============================================================================

# À ajouter dans votre fichier .env frontend :
# VITE_SUPABASE_URL=https://your-project.supabase.co
# VITE_SUPABASE_ANON_KEY=your_anon_key
# VITE_TURNSTILE_SITE_KEY=your_turnstile_site_key
# VITE_APP_URL=https://your-app-domain.com
# VITE_ENABLE_AUTH_DEBUG=false

# =============================================================================
# CHECKLIST DE SÉCURITÉ FINALE
# =============================================================================

# ✅ Rotation des refresh tokens activée
# ✅ Rate limiting configuré
# ✅ Mots de passe robustes exigés
# ✅ Réauthentification pour actions sensibles
# ✅ CAPTCHA activé
# ✅ Monitoring et tracing configurés
# ✅ Providers OAuth sécurisés
# ✅ Emails de confirmation obligatoires
# ✅ RLS activé sur toutes les tables
# ✅ Headers de sécurité configurés
# ✅ Logging approprié configuré
